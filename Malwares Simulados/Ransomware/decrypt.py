#!/usr/bin/env python3

from cryptography.fernet import Fernet
import os


def decrypt_file(file_name, key):
    fernet = Fernet(key)
    with open(file_name, 'rb') as encrypted_file:
        encrypted = encrypted_file.read()
    decrypted = fernet.decrypt(encrypted)
    with open(file_name, 'wb') as decrypted_file:
        decrypted_file.write(decrypted)


if __name__ == "__main__":
    try:
        if not os.path.exists("key.txt"):
            print("O arquivo de chave n√£o foi encontrado!!!")
            exit(1)
        with open("key.txt", "rb") as key_file:
            key = key_file.read()
        for files in os.listdir():
            if files.lower() in ["key.txt", "requirements.txt"] or files.lower().endswith((".py", ".exe")) or os.path.isdir(files):
                continue
            print(f"Descriptografando {files}...")
            decrypt_file(files, key)
        print("Seus arquivos foram descriptografados com sucesso!")
    except Exception as e:
        print(f"Ocorreu um erro durante a descriptografia: {e}")
